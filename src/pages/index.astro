---
import { getCollection } from "astro:content";
import IconRss from "@/assets/icons/IconRss.svg";
import Card from "@/components/Card.astro";
import Footer from "@/components/Footer.astro";
import Header from "@/components/Header.astro";
import Hr from "@/components/Hr.astro";
import Socials from "@/components/Socials.astro";
import { SITE } from "@/config";
import Layout from "@/layouts/Layout.astro";
import getSortedPosts from "@/utils/getSortedPosts";

const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);
const recentPosts = sortedPosts.slice(0, SITE.postPerIndex);
---

<Layout description={SITE.desc}>
  <Header />
  <main id="main-content" data-layout="index">
    <section id="hero" class="pt-6 pb-4">
      <div class="flex flex-col sm:flex-row items-start gap-4">
        <div class="flex-1 text-center sm:text-left">
          <div class="flex items-center gap-2 justify-center sm:justify-start">
            <h1 class="my-2 inline-block text-2xl font-bold sm:my-4 sm:text-3xl">
              Hi, I'm Manoj.
            </h1>
            <a
              target="_blank"
              href="/rss.xml"
              class="inline-block"
              aria-label="rss feed"
              title="RSS Feed"
            >
              <IconRss
                width={20}
                height={20}
                class="scale-125 stroke-accent stroke-3"
              />
              <span class="sr-only">RSS Feed</span>
            </a>
          </div>
          <p class="text-lg text-muted mb-2">iOS Engineer. Swift, Bazel, Monorepos.</p>
          <p>
            I write about iOS development, build systems, and the tools I use.
          </p>
          <div class="mt-4 flex flex-row items-center justify-center sm:justify-start">
            <Socials />
          </div>
        </div>
      </div>
    </section>

    <Hr />

    {
      recentPosts.length > 0 && (
        <section id="recent-posts" class="pt-12 pb-6">
          <ul>
            {recentPosts.map((data) => (
              <Card variant="h3" {...data} showImage={false} />
            ))}
          </ul>
        </section>
      )
    }
  </main>
  <Footer />
</Layout>
